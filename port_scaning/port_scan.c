#include <stdio.h>
#include <sys/socket.h>
#include <netdb.h>
#include <sys/time.h>
#include <arpa/inet.h>


void scanner(char ipAddress[]){

	for(int port = 0; port < 65535; port++){
		int mySocket;
		struct sockaddr_in client;

		mySocket = socket(AF_INET, SOCK_STREAM, 0);
		client.sin_family = AF_INET;
		client.sin_port = htons(port);
		client.sin_addr.s_addr = inet_addr(ipAddress);

		int code = connect(mySocket, (struct sockaddr *)&client, sizeof client);
		
		if(code == 0){
			printf("[+] %i OPEN \n", port);
		}
		
		close(mySocket);
		close(code);
		close(client);
	}
}


int main(int argc, char *argv[]){
		
	if(argc != 3){
		printf("USAGE: ./port_scan [OPTIONS] [TARGET]   \n\n");
		printf("OPTIONS:				\n");
		printf("	-s	for site in target 	\n");
		printf("	-i	for IP address in target  \n");

	}else{

		if(argv[1][1] == 's'){
			struct hostent *site = gethostbyname(argv[2]);
			scanner(inet_ntoa(*((struct in_addr *)site->h_addr)));
		}else if(argv[1][1] == 'i'){
			scanner(argv[2]);
		}else{
			printf("Something is wrong \n");
		}			
	}

	return 0;
}
